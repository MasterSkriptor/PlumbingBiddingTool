@page "/settings"
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime
@rendermode InteractiveServer

<PageTitle>Settings</PageTitle>

<h2>Plumbing Company Information</h2>
<EditForm Model="companyInfo" OnValidSubmit="SaveSettings" FormName="CompanyInfoForm">
    <div class="mb-3">
        <label class="form-label">Company Name</label>
        <InputText class="form-control" @bind-Value="companyInfo.Name" />
    </div>
    <div class="mb-3">
        <label class="form-label">Address</label>
        <InputText class="form-control" @bind-Value="companyInfo.Address" />
    </div>
    <div class="mb-3">
        <label class="form-label">City, State ZIP</label>
        <InputText class="form-control" @bind-Value="companyInfo.CityStateZip" />
    </div>
    <div class="mb-3">
        <label class="form-label">Phone</label>
        <InputText class="form-control" @bind-Value="companyInfo.Phone" />
    </div>
    <div class="mb-3">
        <label class="form-label">Email</label>
        <InputText class="form-control" @bind-Value="companyInfo.Email" />
    </div>
    <button type="submit" class="btn btn-primary">Save</button>
</EditForm>

@code {
    private CompanyInfo companyInfo = new();
    private bool hasLoaded = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!hasLoaded)
        {
            var json = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "companyInfo");
            if (!string.IsNullOrWhiteSpace(json))
            {
                companyInfo = System.Text.Json.JsonSerializer.Deserialize<CompanyInfo>(json) ?? new();
                StateHasChanged();
            }
            hasLoaded = true;
        }
    }

    private async Task SaveSettings()
    {
        var json = System.Text.Json.JsonSerializer.Serialize(companyInfo);
        await JSRuntime.InvokeVoidAsync("localStorage.setItem", "companyInfo", json);
    }

    public class CompanyInfo
    {
        public string Name { get; set; } = string.Empty;
        public string Address { get; set; } = string.Empty;
        public string CityStateZip { get; set; } = string.Empty;
        public string Phone { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
    }
}
